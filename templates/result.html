<!doctype html>
<head>
{% block head %}
<title>Simple Map</title>
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 100%;
    width: 80%;
  }
  #sidebar {
      height: 100%;
      width: 20%;
  }
  #sidebar li.place {
      padding: 5px 10px;

  }
</style>
{% endblock %}
</head>
  <body>
  {% block body %}
  <div id="sidebar">
      <ul class="sidebar">
          {% for listing in listings %}
          <li class="place" id="bnb{{ listing['id'] }}">
              <img id="bnb{{ listing['id'] }}" class="marker-icon">
              <b><a href="http://127.0.0.1:5000/foursquare/{{ listing['id'] }}">{{ listing['title'] }}</a></b>
              <p>Price: {{ listing['price'] }} per night</p>
              <p>Type: {{ listing['type'] }}
              <p>Rating {{ listing['star_rating'] }} from {{ listing['reviews_count'] }} reviews</p>
          </li>
          {% endfor %}
  </div>
    <div id="map"></div>
    <script type="text/javascript"
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script>
    {% block map %}
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: {{ first_lat }},
                   lng: {{ first_lng }} },
          zoom: 12
        });

        var bounds = new google.maps.LatLngBounds();

        {% for listing in listings %}
        var lat = {{ listing['lat'] }};
        var lng = {{ listing['lng'] }};
        var location = new google.maps.LatLng(lat, lng);
        var bnbTitle = "{{ listing['title'] }}";
        var price = {{ listing['price'] }};
        var star_rating = {{ listing['star_rating'] }};
        var num_reviews = {{ listing['reviews_count'] }};

        var contentString = '<b><a href="http://127.0.0.1:5000/foursquare/{{ listing['id']}}">' + bnbTitle + '</a></b>' +
            '<p><b>$' + price + '</b> per night</p>' +
            '<p>Average rating ' + star_rating + ' from ' + num_reviews + ' reviews</p>';

        var infowindow{{ listing['id'] }} = new google.maps.InfoWindow({
              content: contentString
            });


        var bnb{{ listing['id'] }} = new google.maps.Marker({
          position: location,
          map: map,
          title: bnbTitle,
        });

        bounds.extend(bnb{{ listing['id'] }}.position);

        bnb{{ listing['id'] }}.addListener('click', function() {
          infowindow{{ listing['id'] }}.open(map, bnb{{ listing['id'] }});
        });
        {% endfor %}

        map.fitBounds(bounds);
      }
    {% endblock %}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&callback=initMap"
    async defer></script>
    {% endblock %}
</body>
