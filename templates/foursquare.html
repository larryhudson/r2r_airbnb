<!doctype html>
<head>
{% block head %}
<title>Foursquare places</title>
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 100%;
  }
  .map-icon-label .map-icon {
	font-size: 24px;
	color: #FFFFFF;
	line-height: 48px;
	text-align: center;
	white-space: nowrap;
}
</style>
{% endblock %}
</head>
  <body>
  {% block body %}
    <div id="map"></div>
    <script type="text/javascript"
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script>
    {% block map %}
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: {{ airbnb_lat }},
                   lng: {{ airbnb_lng }} },
          zoom: 12
        });

        var bounds = new google.maps.LatLngBounds();

        {% for place in places %}
        var lat = {{ place['venue']['location']['lat'] }};
        var lng = {{ place['venue']['location']['lng'] }};
        var location = new google.maps.LatLng(lat, lng);
        var placeTitle = "{{ place['venue']['name'] }}";
        var rating = {{ place['venue']['rating']}};
        var num_reviews = {{ place['venue']['ratingSignals']}};

        var contentString = '<b>' + placeTitle + '</b>' +
            '<p>Average rating ' + rating + ' from ' + num_reviews + ' reviews</p>';

        var infowindow{{ place['venue']['id'] }} = new google.maps.InfoWindow({
              content: contentString
            });


        var place{{ place['venue']['id'] }} = new google.maps.Marker({
          position: location,
          map: map,
          title: placeTitle,
          icon: {
		    path: MAP_PIN,
		    fillColor: '#DD4B3E',
		    fillOpacity: 1,
		    strokeColor: '',
		    strokeWeight: 0
	},
        });
        place{{ place['venue']['id'] }}.addListener('click', function() {
          infowindow{{ place['venue']['id'] }}.open(map, place{{ place['venue']['id'] }});
        });

        bounds.extend(place{{ place['venue']['id'] }}.position);

        {% endfor %}

        map.fitBounds(bounds);
      }
    {% endblock %}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&callback=initMap"
    async defer></script>
    {% endblock %}
</body>
